# База данных сотрудников & структура организации.



### Технологии: 
Django & DRF

### Цель проекта: 
Создать базу данных сотрудников, а также структуру организации, т.е., кто в каком отделе работает и кто кому приходится начальником, а кто подчиненным.

### Запуск проекта: 
Для корректной работы обоих микросервисов, необходимо

1. Установить зависимости из файла requirements.txt, находится в папке position_microservice или user_microservice (файлы одинаковые)

2. Запустить:

User microservice на 8000 порту

````
    cd user_microservice
    python manage.py runserver
````

Паралельно запустить Positions microservice на 8001

````
    cd position_microservice
    python manage.py runserver 8001
````


### API эндпойнты для взаимодействия:

#### User microservice на 8000 порту

Authentication
- auth/token - Получение(POST) токена для авторизации
- auth/token/refresh - Обновление(POST) токена для авторизации
- auth/token/verify - Проверка(POST) токена для авторизации на валидность

User
- api/user/ - Получения(GET) списка пользователей / Добавление(POST) новых пользователей
- api/user/(<username>/ - Получение(GET)/изменение(PUT)/удаление(DELETE) деталей конкретного пользователя

#### Positions microservice на 8001
- api/positions/node/ -  Получение списка(GET) всех позиций / Добавление(POST) новых позиций в иерархию
- api/positions/node/origins/ - Получение списка(GET) топ позиций(начальники)
- api/positions/node/<pk>/ - Получение(GET)/изменение(PUT)/удаление(DELETE) деталей по определенной позиции
- api/positions/node/<pk>/ancestors/ - Получение списка(GET) всех предков(начальников) для определенной позиции
- api/positions/node/<pk>/descendants/ - Получение списка(GET) всех нижестоящих(подчиненных) для определенной позиции
- api/positions/node/<pk>/child/ - Получение списка(GET) прямых подчиненных(следующие позиции в иерархии) для определенной позиции
- api/positions/node/<pk>/move_with_child/ - Перемещение позиции(PUT) со всеми подчиненными(subtree) по должностной иерархии
- api/positions/node/<pk>/move_without_child/ - Перемещение позиции(PUT) без подчиненных(subtree) по должностной иерархии



#### TODO:
- Добавить тесты
- Добавить визуальную репрезентацию для positions микросервиса
- Изменить взаимодействие микросервисов с HTTP на message broker
- Добавить докер конфиг для упрощения запуска микросервисов


### Архитектура БД

Для реализации задачи была выбрана модель данных "Adjacency list model". В данной конфигурации каждый Node представляет собой отдельную позицию(должность), к которой с помощью связи добавляется пользователь.

Реализация вышеупомянутой модели данных выполнена посредством поля parent, которое хранит в себе запись начальника(Node вышестоящей должности).

В качестве связи пользователя и Node был выбран вариант one-to-many, в таком случае пользователь может занимать несколько должностей в одном дереве. 

#### Плюсами данного подхода являются:

Простота реализации, хорошая производительность при добавлении, перемещении и удалении новых Node, малая потребность в памяти и понятная структура.

#### Минусы:

Плохая производительность при операциях требующих перемещения по дереву, необходимость дополнительных вычислений(запросов) для получения глубины дерева, сложность получения информации о соседних Node.

Стоит отметить что плохую производительность при операциях требующих перемещения по дереву можно обойти если использовать технологию CTE(common table expression), которая позволяет выполнять рекурсивные операции напрямую на сервере SQL.

### REFERENCES
- Representing Hierarchies in Relational Databases, Jacob Rief, Djangocon2018. https://media.ccc.de/v/hd-29-representing-hierarchies-in-relational-databases#t=1083

